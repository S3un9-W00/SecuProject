# Plan: 알고리즘 과제 - 스마트 봇 & 맵 생성 강화

> PDCA Phase: Plan
> Created: 2026-01-31
> Feature: algorithm-tasks

---

## 1. 개요 (Overview)

### 1.1 배경
현재 미로 게임의 적(Enemy)은 오른손 법칙(Right-Hand Rule)을 사용하여 이동하며, 플레이어와 달리 안개(Fog of War)의 제약을 받지 않습니다. 또한 맵 생성기는 기본적인 랜덤 미로만 생성하며, 복잡한 제약 조건을 지원하지 않습니다.

### 1.2 목표
1. **과제 1**: 로봇이 플레이어와 동일한 시야 제한을 받되, 지나온 경로를 기억하여 효율적으로 탐색
2. **과제 2**: 맵 생성기에 복잡한 규칙을 추가하여 품질 높은 미로 생성

---

## 2. 과제 1: 기억하는 스마트 봇 (Memory-based Smart Bot)

### 2.1 현재 상태 분석

**파일**: `Enemy.java`

| 항목 | 현재 상태 |
|------|----------|
| 시야 | 무제한 (전체 맵 접근 가능) |
| 알고리즘 | Right-Hand Rule |
| 메모리 | 방문 횟수만 추적 (visitedCount) |
| 루프 탈출 | 5회 이상 방문 시 랜덤 탈출 |

### 2.2 요구사항

#### 필수 (Must Have)
- [ ] 로봇에게 시야 제한 적용 (플레이어와 동일한 3x3 또는 설정 가능)
- [ ] 탐색한 영역 기억 (Memory Map)
- [ ] 막다른 길 기억 및 회피
- [ ] 미탐색 영역 우선 탐색 전략

#### 선택 (Nice to Have)
- [ ] 횃불 아이템 효과 적용 (시야 확장)
- [ ] 최단 경로 추정 알고리즘

### 2.3 설계 방향

```
┌─────────────────────────────────────────────────────┐
│                   Smart Bot 구조                      │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌──────────────┐    ┌──────────────┐              │
│  │  Vision      │───▶│  Memory      │              │
│  │  (3x3 시야)  │    │  (탐색 기록)   │              │
│  └──────────────┘    └──────────────┘              │
│          │                  │                       │
│          ▼                  ▼                       │
│  ┌──────────────────────────────────┐              │
│  │       Decision Engine            │              │
│  │  - 막다른 길 감지                  │              │
│  │  - 미탐색 영역 탐지                │              │
│  │  - 경로 선택                      │              │
│  └──────────────────────────────────┘              │
│                      │                              │
│                      ▼                              │
│              ┌──────────────┐                       │
│              │   Movement   │                       │
│              └──────────────┘                       │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 2.4 메모리 구조 설계

```java
// 제안하는 메모리 구조
class BotMemory {
    // 탐색한 셀의 실제 값 기억
    Map<Position, CellType> exploredMap;

    // 막다른 길로 확인된 위치
    Set<Position> deadEnds;

    // 아직 탐색하지 않은 방향이 있는 위치 (프론티어)
    Set<Position> frontiers;

    // 이동 경로 히스토리 (백트래킹용)
    Stack<Position> pathHistory;
}
```

### 2.5 알고리즘 전략

| 우선순위 | 전략 | 설명 |
|---------|------|------|
| 1 | 미탐색 영역 탐색 | 시야 내에 '?'(안개)가 있는 방향 우선 |
| 2 | 프론티어로 이동 | 기억된 미탐색 방향이 있는 위치로 이동 |
| 3 | 백트래킹 | 막다른 길이면 경로 역추적 |
| 4 | 최소 방문 선택 | 모두 탐색된 경우 방문 횟수 최소 방향 |

### 2.6 구현 단계

| 단계 | 작업 | 예상 복잡도 |
|------|------|-----------|
| 1 | `BotMemory` 클래스 생성 | 낮음 |
| 2 | 시야 제한 로직 추가 (`getVisibleArea()`) | 중간 |
| 3 | 메모리 업데이트 로직 (`updateMemory()`) | 중간 |
| 4 | 막다른 길 감지 알고리즘 | 중간 |
| 5 | 의사결정 엔진 구현 | 높음 |
| 6 | 기존 `step()` 메서드 리팩토링 | 중간 |

---

## 3. 과제 2: 맵 생성 규칙 강화 (Enhanced Map Generation)

### 3.1 현재 상태 분석

**파일**: `util/MazeGenerator.java`

| 항목 | 현재 상태 |
|------|----------|
| 알고리즘 | 60% 경로, 40% 벽 랜덤 생성 |
| 경로 보장 | BFS로 시작점→목표 경로 확인 |
| 제약 조건 | 없음 |
| 검증 | `MazeValidator`로 기본 검증 |

### 3.2 요구사항

#### 필수 (Must Have)
- [ ] 모든 벽이 하나로 연결되어야 함 (Connected Walls)
- [ ] 최단 경로가 N*2 칸 이상이어야 함 (Minimum Path Length)
- [ ] 막다른 길이 최소 M개 이상 존재 (Dead End Count)

#### 선택 (Nice to Have)
- [ ] 분기점 개수 조절
- [ ] 난이도 파라미터화
- [ ] 대칭 미로 생성 옵션

### 3.3 설계 방향

```
┌─────────────────────────────────────────────────────┐
│              Enhanced Maze Generator                 │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌──────────────────────────────────────────────┐   │
│  │  1. Base Generation (기본 생성)               │   │
│  │     - DFS/Prim/Kruskal 알고리즘 선택           │   │
│  └──────────────────────────────────────────────┘   │
│                      │                              │
│                      ▼                              │
│  ┌──────────────────────────────────────────────┐   │
│  │  2. Constraint Validation (제약 검증)          │   │
│  │     - 벽 연결성 검사                           │   │
│  │     - 최단 경로 길이 검사                       │   │
│  │     - 막다른 길 개수 검사                       │   │
│  └──────────────────────────────────────────────┘   │
│                      │                              │
│           ┌─────────┴─────────┐                     │
│           ▼                   ▼                     │
│      [통과]              [실패]                      │
│         │                   │                       │
│         ▼                   ▼                       │
│  ┌──────────────┐   ┌──────────────┐               │
│  │ 3. Post-     │   │ 3. Repair/   │               │
│  │ Processing   │   │ Regenerate   │               │
│  └──────────────┘   └──────────────┘               │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 3.4 제약 조건 알고리즘

#### 3.4.1 벽 연결성 검사 (Connected Walls)

```
알고리즘: Flood Fill on Walls
1. 아무 벽 셀 하나 선택
2. BFS/DFS로 연결된 모든 벽 탐색
3. 탐색된 벽 개수 == 전체 벽 개수 → 연결됨
```

#### 3.4.2 최단 경로 길이 검사 (Minimum Path Length)

```
알고리즘: BFS Shortest Path
1. 시작점에서 BFS 실행
2. 목표까지의 최단 거리 계산
3. 거리 >= N*2 검증
   - N = 맵 크기 (예: 15x15 → 최소 30칸)
```

#### 3.4.3 막다른 길 개수 검사 (Dead End Count)

```
알고리즘: 통로 이웃 카운트
1. 모든 통로 셀에 대해
2. 인접한 통로 개수 = 1 → 막다른 길
3. 막다른 길 총 개수 >= M 검증
```

### 3.5 구현 단계

| 단계 | 작업 | 예상 복잡도 |
|------|------|-----------|
| 1 | `MazeConstraints` 설정 클래스 생성 | 낮음 |
| 2 | `isWallsConnected()` 검증 메서드 | 중간 |
| 3 | `getShortestPathLength()` 계산 메서드 | 중간 |
| 4 | `countDeadEnds()` 계산 메서드 | 낮음 |
| 5 | `MazeValidator` 확장 | 중간 |
| 6 | 재생성 로직 (실패 시 재시도) | 낮음 |
| 7 | DFS 기반 미로 생성으로 알고리즘 변경 (선택) | 높음 |

---

## 4. 구현 순서 (Implementation Order)

```
Phase 1: 스마트 봇 기본 기능
├── 1.1 BotMemory 클래스 생성
├── 1.2 시야 제한 적용
└── 1.3 메모리 업데이트 로직

Phase 2: 스마트 봇 고급 기능
├── 2.1 막다른 길 감지
├── 2.2 프론티어 기반 탐색
└── 2.3 백트래킹 구현

Phase 3: 맵 생성 규칙
├── 3.1 MazeConstraints 클래스
├── 3.2 벽 연결성 검증
├── 3.3 최단 경로 검증
└── 3.4 막다른 길 개수 검증

Phase 4: 통합 및 테스트
├── 4.1 통합 테스트
└── 4.2 파라미터 튜닝
```

---

## 5. 수정 대상 파일

| 파일 | 수정 유형 | 과제 |
|------|----------|------|
| `Enemy.java` | 대폭 수정 | 과제 1 |
| `BotMemory.java` | 신규 생성 | 과제 1 |
| `util/MazeGenerator.java` | 수정 | 과제 2 |
| `util/MazeValidator.java` | 확장 | 과제 2 |
| `MazeConstraints.java` | 신규 생성 | 과제 2 |

---

## 6. 리스크 및 고려사항

| 리스크 | 영향 | 대응 방안 |
|--------|------|----------|
| 메모리 기반 탐색이 너무 느림 | 게임 반응성 저하 | 시간 제한 + 기본 알고리즘 fallback |
| 제약 조건 충족 미로 생성 실패 | 무한 루프 | 최대 재시도 횟수 설정 (예: 100회) |
| 기존 로직과 충돌 | 버그 발생 | 점진적 통합 + 단위 테스트 |

---

## 7. 검증 기준

### 과제 1 검증
- [ ] 로봇이 시야 밖 정보를 사용하지 않음
- [ ] 막다른 길을 두 번 이상 탐색하지 않음
- [ ] 결국 목표 지점에 도달함

### 과제 2 검증
- [ ] 생성된 미로의 모든 벽이 연결됨
- [ ] 최단 경로가 설정된 최소 길이 이상
- [ ] 막다른 길 개수가 설정된 최소 개수 이상

---

## 8. 다음 단계

Plan 승인 후:
1. `/pdca design algorithm-tasks` 로 상세 설계 진행
2. 각 과제별 클래스 다이어그램 및 시퀀스 다이어그램 작성
3. 구체적인 API 명세 정의
